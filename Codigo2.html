<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>CEREBRAIN - </title>
    <style>
        /* [ESTILOS GLOBALES Y ESTRUCTURA BASE] */
        body { font-family: 'Inter', sans-serif; margin: 0; background: #f2f5ff; }
        /* La vista de inicio se muestra por defecto */
        .view-container { display: none; max-width: 1000px; margin: 20px auto; padding: 0 15px; }
        #home-view { display: block; } /* Mostrar Home por defecto */

        header { background: white; padding: 10px 0; box-shadow: 0 2px 5px rgba(0,0,0,0.1); position: sticky; top: 0; z-index: 10; }
        .nav { display: flex; justify-content: space-between; align-items: center; max-width: 1000px; margin: auto; padding: 0 15px; }
        .brand { font-weight: bold; color: #1e3a8a; font-size: 24px; display: flex; align-items: center; cursor: pointer; }
        .brand .logo { width: 30px; height: 30px; background-color: #1e3a8a; border-radius: 5px; margin-right: 8px; display: inline-block; }

        /* Estilos para los botones de navegación */
        .nav button { 
            color: white; 
            border: none; 
            padding: 8px 15px; 
            border-radius: 6px; 
            margin-left: 10px; 
            font-weight: bold; 
            transition: background 0.3s; 
            cursor: pointer;
        }
        
        /* Estilos específicos de botones */
        .nav button.primary { background: #1e3a8a; } /* Color para Inicio, Dudas, Tutoriales */
        .nav button.primary:hover { background: #3857a6; }
        
        .nav button.logout { background: #e53e3e; } /* Rojo para Cerrar sesión */
        .nav button.logout:hover { background: #c53030; }

        /* Botón de Notificaciones- Naranja */
        .nav button.notifications { 
            background: #ff9800; 
            position: relative; 
            padding: 8px 15px;
            line-height: 1; 
        } 
        .nav button.notifications:hover { background: #e68900; }

        /* Botón de Perfil - Verde */
        .nav button#perfil-btn {
            background: #48bb78;
        }
        .nav button#perfil-btn:hover {
            background: #38a169;
        }
        
        /* Indicador de Notificaciones Pendientes */
        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background-color: #e53e3e;
            color: white;
            border-radius: 50%;
            padding: 2px 6px;
            font-size: 10px;
            font-weight: bold;
        }

        /* Clase para el botón activo */
        .nav button.activo { 
            filter: brightness(1.2); /* Un ligero brillo para destacar */
        }
        
        /* Estado activo inicial para el botón de Inicio */
        #home-btn { background-color: #3857a6 !important; }

        /* Layout Grid para TODAS las vistas principales (2 columnas) */
        .main-grid { 
            display: grid; 
            grid-template-columns: 220px 1fr; 
            gap: 20px; 
        } 
        
        /* Layout Grid para las vistas con ASIDE ELIMINADO (PERFIL y NOTIFICACIONES) */
        .main-grid.single-column {
            grid-template-columns: 1fr;
        }

        .aside, .section { 
            background: white; 
            padding: 20px; 
            border-radius: 10px; 
            box-shadow: 0 2px 5px rgba(0,0,0,0.05); 
        }

        /* ASIDE: Estilos de Navegación Rápida/Opciones */
        .aside h3 { margin-top: 0; color: #1e3a8a; font-size: 1.2rem; }
        .area button { 
            display: block; width: 100%; margin-bottom: 8px; padding: 10px; cursor: pointer; border: 1px solid #ddd; background: #fff; border-radius: 6px; text-align: left; font-weight: 500; transition: background 0.2s; 
            color: #4a5568;
        }
        .area button:hover { background: #eef2ff; border-color: #cdd5f3; }
        
        /* HOME: Card styles  */
        .section h2 { color: #2d3748; margin-top: 0; }
        .section h3 { color: #1e3a8a; border-bottom: 2px solid #e2e8f0; padding-bottom: 8px;}

        .card { 
            border: 1px solid #eee; 
            padding: 15px; 
            border-radius: 8px; 
            margin-bottom: 15px; 
            cursor: default; 
            box-shadow: 0 1px 3px rgba(0,0,0,0.05); 
            background: #fff;
        }
        .card:hover { box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        .card h3 { 
            margin: 0 0 5px 0; 
            font-size: 1.1rem; 
            color: #1e3a8a; 
            border-bottom: none;
            padding-bottom: 0;
        }
        .card p {
            font-size: 0.95rem;
            color: #4a5568;
            margin: 0 0 10px 0;
        }
        .duda-card {
             border-left: 4px solid #4299e1; /* Borde azul para dudas */
        }
        .duda-card .meta {
            font-size: 0.85rem;
            color: #718096;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 10px;
            padding-top: 5px;
            border-top: 1px dotted #e2e8f0;
        }
        .tutorial-card {
             border-left: 4px solid #3f51b5; /* Borde morado/azul para tutoriales */
        }
        .tutorial-card h3 {
            color: #3f51b5;
        }
        .tag { background: #eef2ff; color: #1e3a8a; padding: 3px 8px; border-radius: 12px; font-size: 12px; margin-right: 5px; display: inline-block; margin-top: 5px;}


        /* ========================================================== */
        /* ESTILO: Para las respuestas y COMENTARIOS */
        /* ========================================================== */
        .respuesta-card {
            border: 1px solid #ddd;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            background: #fcfcfc;
            border-left: 3px solid #48bb78; /* Borde verde para respuestas */
            box-shadow: 0 1px 2px rgba(0,0,0,0.05);
            position: relative; /* Necesario para los botones de acción */
        }
        .respuesta-card .meta-respuesta {
            font-size: 0.8rem;
            color: #718096;
            margin-top: 10px;
            padding-top: 5px;
            border-top: 1px dotted #e2e8f0;
            display: flex;
            justify-content: space-between; /* Para alinear los botones a la derecha */
            align-items: center;
        }
        .respuesta-card p {
            margin: 0;
            line-height: 1.5;
        }
        /* Estilo para los botones de acción de las respuestas */
        .respuesta-actions button {
            background: none;
            border: none;
            font-size: 0.8rem;
            margin-left: 10px;
            cursor: pointer;
            padding: 3px 5px;
            border-radius: 4px;
            transition: background 0.2s;
        }
        .respuesta-actions .edit-btn { color: #4299e1; }
        .respuesta-actions .edit-btn:hover { background: #ebf8ff; }
        .respuesta-actions .delete-btn { color: #e53e3e; }
        .respuesta-actions .delete-btn:hover { background: #fff5f5; }
        
        /* ESTILO ESPECÍFICO PARA COMENTARIOS (Mantenido aunque se elimine la funcionalidad del tutorial) */
        .comentario-card {
            border: 1px solid #eee;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            background: #f9f9ff;
            border-left: 3px solid #3f51b5; /* Borde azul/morado para comentarios */
            box-shadow: 0 1px 2px rgba(0,0,0,0.05);
            position: relative;
        }
        .comentario-card p {
            margin: 0;
            line-height: 1.5;
        }
        .comentario-card .meta-comentario {
            font-size: 0.8rem;
            color: #718096;
            margin-top: 10px;
            padding-top: 5px;
            border-top: 1px dotted #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        /* ESTILO EXTRA PARA EL INPUT DE ARCHIVO (mejor visualización) - MANTENIDO POR SI EL USUARIO LO USA DESPUÉS */
        .file-input-container input[type="file"] {
            border: 1px solid #ccc;
            padding: 8px;
            border-radius: 4px;
            display: block;
            width: 100%;
            box-sizing: border-box;
            background: #f9f9f9;
        }

        /* ========================================================== */
        /* ESTILOS ESPECÍFICOS DE TUTORIALES */
        /* ========================================================== */
        .tutorial-item {
            display: flex;
            margin-bottom: 25px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.06);
            background: #fff;
            cursor: pointer; /* AÑADIDO: para que los elementos de la lista sean clicables */
            transition: transform 0.2s;
        }
        .tutorial-item:hover { /* AÑADIDO: para indicar que es clicable */
            transform: translateY(-3px);
            box-shadow: 0 6px 10px -1px rgba(0, 0, 0, 0.15), 0 3px 6px -2px rgba(0, 0, 0, 0.10);
        }
        .video-container {
            flex-shrink: 0;
            width: 300px;
            height: 180px;
            background-color: #000;
        }
        .video-container iframe {
            width: 100%;
            height: 100%;
            border: none;
        }
        .tutorial-content {
            padding: 15px;
            flex-grow: 1;
        }
        .tutorial-content h4 {
            margin-top: 0;
            margin-bottom: 5px;
            color: #1e3a8a;
            font-size: 1.2rem;
        }
        .tutorial-content p {
            font-size: 0.9rem;
            color: #4a5568;
            margin-bottom: 10px;
        }
        .tutorial-meta {
            font-size: 0.8rem;
            color: #718096;
            border-top: 1px dotted #e2e8f0;
            padding-top: 5px;
            display: flex;
            justify-content: space-between;
        }
        /* ========================================================== */
        
        /* ========================================================== */
        /* PERFIL:  */
        /* ========================================================== */
        .profile-container { display: flex; flex-direction: column; align-items: center; text-align: center; width: 100%;}
        .profile-card { max-width: 600px; width: 100%; background: #fff; padding: 30px; border-radius: 12px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); margin: 0 auto; border: 1px solid #e2e8f0; }
        .avatar { 
            width: 120px; height: 120px; border-radius: 50%; background: #eef2ff; color: #1e3a8a; font-size: 50px; border: 3px solid #1e3a8a; margin-bottom: 20px; display: flex; align-items: center; justify-content: center; 
        }
        .profile-card h2 { color: #1e3a8a; margin-top: 0; font-size: 1.8rem; }
        .info-row { 
            display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px dashed #e2e8f0; text-align: left; font-size: 0.95rem; 
        }
        .info-label { font-weight: 500; color: #4a5568; }
        .info-value { color: #2d3748; font-weight: bold; text-align: right; }

        /* Estilos del Formulario de Edición (existentes) */
        .form-group { text-align: left; margin-bottom: 15px; }
        .form-group label { display: block; font-weight: bold; color: #4a5568; margin-bottom: 5px; }
        .form-group input, .form-group select { 
            width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; font-size: 1rem;
        }
        
        /*  Botones de Acción (existentes) */
        .action-btn { 
            border: none; padding: 10px 20px; border-radius: 5px; font-weight: bold; cursor: pointer; transition: background 0.3s; margin-top: 20px; margin-right: 10px;
        }
        .action-btn i { margin-right: 5px; }
        .edit-btn { background: #4299e1; color: white; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .edit-btn:hover { background: #3182ce; }
        .save-btn { background: #38a169; color: white; }
        .save-btn:hover { background: #2f855a; }
        .cancel-btn { background: #a0aec0; color: white; }
        .cancel-btn:hover { background: #718096; }
        

        /* ========================================================== */
        /* NOTIFICACIONES: (Estilos existentes) */
        /* ========================================================== */
        .notification-list { margin-top: 20px; }
        .notification-item { display: flex; align-items: flex-start; background: #f7f7f7; padding: 15px; border-radius: 8px; margin-bottom: 10px; border-left: 5px solid #4a5568; transition: all 0.2s; cursor: pointer;}
        .notification-item.unread { background: #fff3e0; border-left: 5px solid #ff9800; font-weight: bold;}
        .notif-icon { font-size: 20px; margin-right: 15px; color: #1e3a8a; line-height: 1.5; }
        .notif-content a { color: #4299e1; text-decoration: none; font-weight: bold; }
        .toggle-switch-container { display: flex; align-items: center; justify-content: space-between; padding: 15px; border-radius: 8px; background: #eef2ff; margin-bottom: 20px; border: 1px solid #cdd5f3;}
        .switch { position: relative; display: inline-block; width: 60px; height: 34px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 34px; }
        .slider:before { position: absolute; content: ""; height: 26px; width: 26px; left: 4px; bottom: 4px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: #2f855a; }
        input:checked + .slider:before { transform: translateX(26px); }
        .success { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; padding: 10px; border-radius: 4px; }
        .info { background-color: #e6f3ff; color: #1e3a8a; border: 1px solid #cdd5f3; padding: 10px; border-radius: 4px; }

        /* ========================================================== */
        /* ESTILOS PARA EL MODAL */
        /* ========================================================== */
        .modal {
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.6);
            display: none; 
        }
        .modal-content {
            background-color: #fefefe;
            margin: 8% auto;
            padding: 30px;
            border: 1px solid #888;
            width: 90%;
            max-width: 500px;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            animation: fadeIn 0.3s;
        }
        .modal-close {
            color: #aaa;
            float: right;
            font-size: 30px;
            font-weight: bold;
            line-height: 1;
        }
        .modal-close:hover,
        .modal-close:focus {
            color: #e53e3e;
            text-decoration: none;
            cursor: pointer;
        }
        .form-group textarea {
            width: 100%; 
            padding: 10px; 
            border: 1px solid #ccc; 
            border-radius: 4px; 
            box-sizing: border-box; 
            font-size: 1rem;
            min-height: 100px;
            resize: vertical;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>

<div id="app-container">
    <header id="main-header">
        <div class="nav">
            <div class="brand" onclick="cambiarVista('home-view')">
                <span class="logo"></span> 
                CEREBRAIN
            </div>
            <div>
                <button id="home-btn" class="primary activo" style="background-color: #3857a6;" onclick="cambiarVista('home-view')">Inicio</button>
                
                <button class="notifications" id="notif-btn" onclick="cambiarVista('notificaciones-view')">
                    Notificaciones
                    <span id="notif-badge" class="notification-badge" style="display: none;"></span>
                </button>
                
                <button id="dudas-btn" class="primary" onclick="cambiarVista('foro-dudas-view')">Dudas</button>
                
                <button id="tutoriales-btn" class="primary" onclick="cambiarVista('tutoriales-view')">Tutoriales</button>
                
                <button id="perfil-btn" class="primary" onclick="cambiarVista('perfil-view')">Perfil</button>
                
                <button class="logout" onclick="window.location.href='login.html'">Cerrar sesión</button>

            </div>
        </div>
    </header>

    <div id="home-view" class="view-container">
        <div class="main-grid">
            <aside class="aside">
                <h3>Navegación Rápida</h3>
                <div class="area">
                    <button onclick="cambiarVista('foro-dudas-view')">Ir a Foro de Dudas</button>
                    <button onclick="cambiarVista('tutoriales-view')">Ver Tutoriales</button>
                </div>
            </aside>
            <section class="section">
                <h2>Tablero de Inicio</h2>
                <p>Bienvenido. Usa la barra de navegación para saltar entre las secciones.</p>

                <h3>Últimas Dudas </h3>
                <div class="card duda-card" onclick="mostrarDetalleDuda(101)" style="cursor: pointer;">
                    <h3>¿Cómo resolver un sistema 3x3 por sustitución?</h3>
                    <p>Estoy atascado en el paso de despeje de la tercera variable. Intenté despejar z de la tercera ecuación. Intenté despejar z de la tercera ecuación, pero al sustituir en las otras dos, las expresiones se vuelven demasiado complejas. ¿Existe alguna forma más sencilla de abordar este problema con el método de sustitución, o es mejor cambiar a otro método como Gauss? Necesito un ejemplo o un consejo para simplificar los pasos.</p>
                    <div><span class="tag">álgebra</span><span class="tag">ecuaciones</span></div>
                    <div class="meta">
                        <span>Matemáticas</span>
                        <span>6 Respuestas</span> 
                    </div>
                </div>

                <h3>Tutorial Destacado </h3>
                <div class="card tutorial-card" onclick="cambiarVista('tutoriales-view')" style="cursor: pointer;">
                    <h3><i class="fas fa-video"></i> Introducción al Modelo OSI</h3>
                    <p>Comprende la arquitectura de red capa por capa.</p>
                     <div class="meta">
                        <span>Redes</span>
                        <span>8:30 min</span>
                    </div>
                </div>
            </section>
        </div>
    </div>
    
    <div id="foro-dudas-view" class="view-container">
        <div class="main-grid">
            <aside class="aside">
                <h3>Filtrar por Área</h3>
                <div class="area">
                    <button onclick="filtrarDudas('all')"><i class="fas fa-globe"></i> Todas las áreas</button>
                    <button onclick="filtrarDudas('Redes')"><i class="fas fa-network-wired"></i> Redes</button>
                    <button onclick="filtrarDudas('Matematicas')"><i class="fas fa-calculator"></i> Matemáticas</button>
                    <button onclick="filtrarDudas('SistemasDigitales')"><i class="fas fa-microchip"></i> Sistemas Digitales</button>
                </div>
                
                <h3 style="margin-top: 20px;">Acciones</h3>
                <div class="area">
                    <button class="edit-btn" style="background:#1e3a8a; color:white; text-align: center;" onclick="abrirModal('dudaModal')"><i class="fas fa-plus"></i> Publicar Nueva Duda</button>
                </div>
                
            </aside>
            <section class="section">
                <h2><i class="fas fa-comments"></i> Foro de Dudas</h2>
                <p>Explora y ayuda a resolver preguntas de la comunidad. Total de dudas: <b id="dudas-total-count">0</b></p>
                
                <div id="dudas-list">
                    </div>
                
                <div id="status-message-duda" class="info" style="display: none;"></div>
                
            </section>
        </div>
    </div>

    <div id="duda-detalle-view" class="view-container">
        <div class="main-grid single-column">
            <section class="section">
                <button class="action-btn cancel-btn" onclick="cambiarVista('foro-dudas-view')" style="margin-bottom: 20px;">
                    <i class="fas fa-arrow-left"></i> Volver al Foro
                </button>
                
                <div id="detalle-duda-card" class="card" style="border-left: 5px solid #1e3a8a; padding: 25px;">
                    <h2 id="detalle-titulo" style="color: #1e3a8a; margin-bottom: 10px; border-bottom: none;"></h2>
                    <p style="font-size: 0.9rem; color: #718096; margin-bottom: 20px;">
                        Publicada por <b id="detalle-autor"></b> el <span id="detalle-fecha"></span> en el área de <b id="detalle-area"></b>.
                    </p>
                    
                    <hr style="border: 0; border-top: 1px dashed #e2e8f0; margin: 15px 0;">
                    
                    <p id="detalle-descripcion" style="white-space: pre-wrap; color: #2d3748; font-size: 1rem; line-height: 1.6;"></p>
                    
                    <div id="detalle-tags" style="margin-top: 15px; padding-top: 10px; border-top: 1px dotted #e2e8f0;"></div>

                </div>
                
                <h3 style="margin-top: 30px; color: #2d3748;">Respuestas (<span id="respuestas-count">0</span>)</h3>
                <div id="respuestas-list">
                    </div>

                <hr style="border: 0; border-top: 1px solid #e2e8f0; margin: 30px 0;">
                
                <h3 style="margin-top: 30px; color: #2d3748;">Añadir tu Respuesta</h3>
                <form id="new-respuesta-form" onsubmit="event.preventDefault(); agregarRespuesta(currentDudaId);">
                    <div class="form-group">
                        <textarea id="respuestaTexto" placeholder="Escribe aquí tu respuesta detallada..." required></textarea>
                    </div>
                    
                    <button type="submit" class="action-btn edit-btn" style="background: #48bb78; color: white; margin-right: 0;"><i class="fas fa-reply"></i> Publicar Respuesta</button>
                    <div id="status-message-respuesta-add" class="info" style="display: none; margin-top: 10px;"></div>
                </form>
                
            </section>
        </div>
    </div>


    <div id="perfil-view" class="view-container">
        <div class="main-grid single-column">
            <section class="section">
                <div id="perfil-lectura">
                    <div class="profile-container">
                        <div class="profile-card">
                            <div class="avatar"><i class="fas fa-user"></i></div>
                            <h2 id="perfil-nombre-display"></h2>
                            <p id="perfil-desc-display" style="color: #718096; margin-bottom: 30px;"></p>

                            <div class="profile-info">
                                <div class="info-row">
                                    <span class="info-label">Nombre Completo:</span>
                                    <span class="info-value" id="info-nombre"></span>
                                </div>
                                <div class="info-row">
                                    <span class="info-label">Correo Electrónico:</span>
                                    <span class="info-value" id="info-email"></span>
                                </div>
                                <div class="info-row">
                                    <span class="info-label">Área de Interés Principal:</span>
                                    <span class="info-value" id="info-interes"></span>
                                </div>
                                <div class="info-row">
                                    <span class="info-label">Miembro desde:</span>
                                    <span class="info-value" id="info-miembro"></span>
                                </div>
                                <div class="info-row" style="border-bottom: none;">
                                    <span class="info-label">Total de Contribuciones:</span>
                                    <span class="info-value" id="info-contribuciones"></span>
                                </div>
                            </div>

                            <button class="action-btn edit-btn" onclick="mostrarSubVistaPerfil('perfil-edicion')">
                                <i class="fas fa-edit"></i> Editar Perfil
                            </button>
                        </div>
                    </div>
                </div>

                <div id="perfil-edicion" style="display: none;">
                    <div class="profile-container">
                        <div class="profile-card">
                            <div class="avatar"><i class="fas fa-user-edit"></i></div>
                            <h2>Editar Perfil de Usuario</h2>
                            <p style="color: #718096; margin-bottom: 20px; font-size: 0.9rem;">Actualiza tu información personal y tus áreas de interés.</p>

                            <form id="profile-form" onsubmit="event.preventDefault(); guardarPerfil();">
                                <div class="form-group"><label for="nombreCompleto">Nombre Completo:</label><input type="text" id="nombreCompleto" required></div>
                                <div class="form-group"><label for="email">Correo Electrónico:</label><input type="email" id="email" required></div>
                                <div class="form-group">
                                    <label for="interesPrincipal">Área de Interés Principal:</label>
                                    <select id="interesPrincipal" required>
                                        <option value="Redes">Redes y Telecomunicaciones</option>
                                        <option value="Matematicas">Matemáticas</option>
                                        <option value="SistemasDigitales">Sistemas Digitales</option>
                                    </select>
                                </div>
                                <div class="form-group"><label for="descripcion">Descripción Breve:</label><input type="text" id="descripcion"></div>

                                <div style="display: flex; justify-content: center; gap: 10px; margin-top: 20px;">
                                    <button type="submit" class="action-btn save-btn"><i class="fas fa-save"></i> Guardar Cambios</button>
                                    <button type="button" class="action-btn cancel-btn" onclick="mostrarSubVistaPerfil('perfil-lectura')"><i class="fas fa-times"></i> Cancelar</button>
                                </div>
                                
                                <div id="status-message-perfil" class="success"></div>
                            </form>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </div>
    
    <div id="notificaciones-view" class="view-container">
        <div class="main-grid single-column">
            <section class="section">
                <h2><i class="fas fa-bell"></i> Centro de Notificaciones</h2>
                
                <div class="area" style="display: flex; gap: 10px; margin-bottom: 20px;">
                    <select id="notif-filter" style="padding: 10px; border-radius: 4px; border: 1px solid #ccc; font-size: 1rem;">
                        <option value="all">Todas</option>
                    </select>
                </div>

                <div class="toggle-switch-container">
                    <span class="toggle-label">Activar Notificaciones de Respuesta</span>
                    <label class="switch">
                        <input type="checkbox" id="toggleNotificaciones" onchange="toggleNotif(this)">
                        <span class="slider"></span>
                    </label>
                </div>

                <div id="status-message-notif" class="info"></div>

                <h3 style="color:#2d3748; font-weight: bold; border-bottom: none; padding-bottom: 0;">Notificaciones Recientes (<span id="notif-count"></span> no leídas)</h3>
                
                <div id="notif-list" class="notification-list">
                    </div>

                <button class="action-btn cancel-btn" onclick="marcarTodasLeidas()">Marcar todas como leídas</button>
            </section>
        </div>
    </div>

    <div id="tutoriales-view" class="view-container">
        <div class="main-grid">
            <aside class="aside">
                <h3>Filtrar Tutoriales</h3>
                <div class="area">
                    <button onclick="filtrarTutoriales('all')"><i class="fas fa-globe"></i> Todos</button>
                    <button onclick="filtrarTutoriales('Redes')"><i class="fas fa-network-wired"></i> Redes</button>
                    <button onclick="filtrarTutoriales('Matematicas')"><i class="fas fa-calculator"></i> Matemáticas</button>
                    <button onclick="filtrarTutoriales('SistemasDigitales')"><i class="fas fa-microchip"></i> Sistemas Digitales</button>
                </div>
                
                <h3 style="margin-top: 20px;">Acciones</h3>
                <div class="area">
                    <button class="edit-btn" style="background:#3f51b5; color:white; text-align: center;" onclick="abrirModal('tutorialModal')"><i class="fas fa-plus-circle"></i> Publicar Tutorial</button>
                </div>
            </aside>
            <section class="section">
                <h2><i class="fas fa-book-reader"></i> Videotutoriales por Área</h2>
                <p>Aprende con videos creados por la comunidad y expertos. Total de tutoriales: <b id="tutoriales-total-count">0</b></p>
                
                <div id="tutoriales-list">
                    </div>
                
                <div id="status-message-tutorial" class="info" style="display: none;"></div>
            </section>
        </div>
    </div>
    <div id="tutorial-detalle-view" class="view-container">
        <div class="main-grid single-column">
            <section class="section">
                <button class="action-btn cancel-btn" onclick="cambiarVista('tutoriales-view')" style="margin-bottom: 20px;">
                    <i class="fas fa-arrow-left"></i> Volver a Tutoriales
                </button>
                
                <div id="detalle-tutorial-card" class="card" style="border-left: 5px solid #3f51b5; padding: 25px;">
                    <h2 id="tutorial-detalle-titulo" style="color: #3f51b5; margin-bottom: 10px; border-bottom: none;"></h2>
                    <p style="font-size: 0.9rem; color: #718096; margin-bottom: 20px;">
                        Publicado por <b id="tutorial-detalle-autor"></b> el <span id="tutorial-detalle-fecha"></span> en el área de <b id="tutorial-detalle-area"></b>.
                    </p>
                    
                    <div id="tutorial-video-container" class="video-container" style="width: 100%; height: 500px; margin-bottom: 20px; border-radius: 8px; overflow: hidden;">
                        </div>
                    
                    <hr style="border: 0; border-top: 1px dashed #e2e8f0; margin: 15px 0;">
                    
                    <p id="tutorial-detalle-descripcion" style="white-space: pre-wrap; color: #2d3748; font-size: 1rem; line-height: 1.6;"></p>
                </div>
                
                <h3 style="margin-top: 30px; color: #2d3748;">Comentarios (<span id="comentarios-count">0</span>)</h3>
                <div id="comentarios-list">
                    </div>

                <hr style="border: 0; border-top: 1px solid #e2e8f0; margin: 30px 0;">
                
                <h3 style="margin-top: 30px; color: #2d3748;">Añadir tu Comentario</h3>
                <form id="new-comentario-form" onsubmit="event.preventDefault(); agregarComentario(currentTutorialId);">
                    <div class="form-group">
                        <textarea id="comentarioTexto" placeholder="Escribe aquí tu comentario (Máx. 500 caracteres)..." required maxlength="500"></textarea>
                    </div>
                    
                    <button type="submit" class="action-btn edit-btn" style="background: #3f51b5; color: white; margin-right: 0;"><i class="fas fa-comment"></i> Publicar Comentario</button>
                    <div id="status-message-comentario-add" class="info" style="display: none; margin-top: 10px;"></div>
                </form>
                </section>
        </div>
    </div>
    </div>

<div id="dudaModal" class="modal">
    <div class="modal-content">
        <span class="modal-close" onclick="cerrarModal('dudaModal')">&times;</span>
        <h2 style="color: #1e3a8a;"><i class="fas fa-question-circle"></i> Publicar Nueva Duda</h2>
        <p style="color: #718096; font-size: 0.9rem;">Tu duda será visible para toda la comunidad.</p>
        <form id="new-duda-form" onsubmit="event.preventDefault(); publicarDuda();">
            <div class="form-group"><label for="dudaTitulo">Título (máx. 3000 caracteres):</label><input type="text" id="dudaTitulo" maxlength="3000" required></div>
            <div class="form-group">
                <label for="dudaArea">Área Principal:</label>
                <select id="dudaArea" required>
                    <option value="">Selecciona un área...</option>
                    <option value="Redes">Redes y Telecomunicaciones</option>
                    <option value="Matematicas">Matemáticas</option>
                    <option value="SistemasDigitales">Sistemas Digitales</option>
                </select>
            </div>
            <div class="form-group"><label for="dudaDescripcion">Descripción detallada:</label><textarea id="dudaDescripcion" required></textarea></div>
            <div class="form-group"><label for="dudaTags">Etiquetas (separadas por comas):</label><input type="text" id="dudaTags" placeholder="ej: álgebra, vectores, lógica"></div>
            
            <div id="status-message-modal" style="display: none;"></div>

            <button type="submit" class="action-btn save-btn" style="margin-top: 10px; display: block; width: 100%;"><i class="fas fa-paper-plane"></i> Publicar Duda</button>
        </form>
    </div>
</div>

<div id="tutorialModal" class="modal">
    <div class="modal-content">
        <span class="modal-close" onclick="cerrarModal('tutorialModal')">&times;</span>
        <h2 style="color: #3f51b5;"><i class="fas fa-video"></i> Publicar Nuevo Videotutorial</h2>
        <p style="color: #718096; font-size: 0.9rem;">Comparte un enlace de YouTube o similar.</p>
        <form id="new-tutorial-form" onsubmit="event.preventDefault(); publicarTutorial();">
            <div class="form-group"><label for="tutorialTitulo">Título del Tutorial:</label><input type="text" id="tutorialTitulo" required></div>
            <div class="form-group">
                <label for="tutorialArea">Área Principal:</label>
                <select id="tutorialArea" required>
                    <option value="">Selecciona un área...</option>
                    <option value="Redes">Redes y Telecomunicaciones</option>
                    <option value="Matematicas">Matemáticas</option>
                    <option value="SistemasDigitales">Sistemas Digitales</option>
                </select>
            </div>
            <div class="form-group"><label for="tutorialDescripcion">Descripción:</label><textarea id="tutorialDescripcion" required></textarea></div>
            <div class="form-group">
                <label for="tutorialEnlace">Enlace de Video (Ej. YouTube URL):</label>
                <input type="url" id="tutorialEnlace" placeholder="https://www.youtube.com/watch?v=XXXXXXX o https://www.youtube.com/embed/XXXXXXX" required>
                <p style="font-size: 0.75rem; color: #718096; margin-top: 5px;">*Puedes usar el enlace normal (`watch?v=...`) o el de `embed`.</p>
            </div>
            
            <div id="status-message-tutorial-modal" style="display: none;"></div>

            <button type="submit" class="action-btn save-btn" style="background:#3f51b5; margin-top: 10px; display: block; width: 100%;"><i class="fas fa-upload"></i> Publicar Tutorial</button>
        </form>
    </div>
</div>
<div id="editarRespuestaModal" class="modal">
    <div class="modal-content">
        <span class="modal-close" onclick="cerrarModal('editarRespuestaModal')">&times;</span>
        <h2 style="color: #1e3a8a;"><i class="fas fa-edit"></i> Editar Respuesta</h2>
        <form id="edit-respuesta-form" onsubmit="event.preventDefault(); guardarEdicionRespuesta();">
            <input type="hidden" id="editDudaId">
            <input type="hidden" id="editRespuestaId">
            <div class="form-group">
                <label for="editRespuestaTexto">Texto de la Respuesta:</label>
                <textarea id="editRespuestaTexto" required></textarea>
            </div>
            <div id="status-message-respuesta-edit" class="success" style="display: none;"></div>
            <button type="submit" class="action-btn save-btn" style="margin-top: 10px; display: block; width: 100%;"><i class="fas fa-save"></i> Guardar Edición</button>
        </form>
    </div>
</div>

<div id="editarComentarioModal" class="modal">
    <div class="modal-content">
        <span class="modal-close" onclick="cerrarModal('editarComentarioModal')">&times;</span>
        <h2 style="color: #3f51b5;"><i class="fas fa-edit"></i> Editar Comentario</h2>
        <form id="edit-comentario-form" onsubmit="event.preventDefault(); guardarEdicionComentario();">
            <input type="hidden" id="editTutorialId">
            <input type="hidden" id="editComentarioId">
            <div class="form-group">
                <label for="editComentarioTexto">Texto del Comentario:</label>
                <textarea id="editComentarioTexto" required maxlength="500"></textarea>
            </div>
            <div id="status-message-comentario-edit" class="success" style="display: none;"></div>
            <button type="submit" class="action-btn save-btn" style="background: #3f51b5; margin-top: 10px; display: block; width: 100%;"><i class="fas fa-save"></i> Guardar Edición</button>
        </form>
    </div>
</div>
<footer>
    <p style="text-align:center; padding:20px; font-size:14px; color:#666; margin-top:20px;"> CEREBRAIN 2025 </p>
</footer>

<script>
    // ==========================================================
    // VARIABLES GLOBALES DE ESTADO
    // ==========================================================
    let usuario = {
        nombreCompleto: "Karen Silva",
        email: "karen.silva@dominio.com",
        interesPrincipal: "Redes",
        interesPrincipalDisplay: "Redes y Telecomunicaciones",
        descripcion: "¡Estudiante apasionado por las redes!",
        miembroDesde: "Enero 2025", 
        contribuciones: "18 dudas / 5 tutoriales" 
    };

    let notificacionesActivadas = true; 
    let currentNotifFilter = 'all';
    let currentDudaFilter = 'all';
    let currentDudaId = null; 
    let currentTutorialFilter = 'all'; 
    let currentTutorialId = null;

    const interesMap = {
        "Redes": "Redes y Telecomunicaciones",
        "Matematicas": "Matemáticas",
        "SistemasDigitales": "Sistemas Digitales",
    };

    let notificaciones = [
        { id: 1, tipo: 'duda', titulo: 'Sistema 3x3 por sustitución', texto: 'El usuario *Carlos Montes* ha respondido en la duda que comentaste..', leida: false, targetId: 101 },
    ];
    
    let dudas = [
        { 
            id: 101, 
            titulo: "¿Cómo resolver un sistema 3x3 por sustitución?", 
            descripcion: "Estoy atascado en el paso de despeje de la tercera variable. Intenté despejar z de la tercera ecuación. Intenté despejar z de la tercera ecuación, pero al sustituir en las otras dos, las expresiones se vuelven demasiado complejas. ¿Existe alguna forma más sencilla de abordar este problema con el método de sustitución, o es mejor cambiar a otro método como Gauss? Necesito un ejemplo o un consejo para simplificar los pasos.", 
            autor: "Esteban Torres", 
            area: "Matematicas", 
            tags: ["álgebra", "ecuaciones"], 
            fecha: "2025-01-20",
            respuestasList: [
                { id: 1011, autor: "Carlos Montes", texto: "Te recomiendo usar el método de Gauss para sistemas 3x3. Sustitución es más propenso a errores en las variables intermedias. En este caso, si la tercera ecuación es simple, despeja z, pero sustitúyela directamente en la primera y segunda.", fecha: "2025-01-20" },
                { id: 1012, autor: "Ana Pérez", texto: "Yo logré resolverlo por sustitución enfocándome primero en despejar la variable con coeficiente 1 si existe. Si no, sí, Gauss es la mejor opción para evitar complejidades innecesarias. ¡Ánimo!", fecha: "2025-01-21" },
                { id: 1013, autor: "Karen Silva", texto: "¡Despeja una variable, sustitúyela en las otras ecuaciones y resuelve paso a paso; si se complica, usa el método de Gauss.", fecha: "2025-01-22" },
                { id: 1015, autor: "Novato Aprendiz", texto: "Gracias por el consejo, intentaré con Gauss. Siempre me pierdo al sustituir la tercera vez.", fecha: "2025-01-23" },
                { id: 1016, autor: "Docente UVM", texto: "El método de sustitución es válido, pero sí, a partir de 3x3 se prefiere la eliminación Gaussiana o la Regla de Cramer. No te frustres, es normal que se complique.", fecha: "2025-01-24" }
            ]
        },
        { 
            id: 102, 
            titulo: "Diferencia entre switch y hub", 
            descripcion: "Necesito entender las principales diferencias a nivel de capa OSI.", 
            autor: "Laura Ramos", 
            area: "Redes", 
            tags: ["hardware", "capa-2"], 
            fecha: "2025-02-10",
            respuestasList: [
                 { id: 1021, autor: "Experto Redes", texto: "Un switch opera en la capa 2 (Enlace de datos) y usa la dirección MAC para enviar tramas al destino específico. Un hub opera en la capa 1 (Física) y reenvía la señal a todos los puertos, generando colisiones y más tráfico innecesario.", fecha: "2025-02-10" },
                 { id: 1023, autor: "Soporte Técnico", texto: "La clave es la inteligencia: el switch 'aprende' las MACs (Capa 2), el hub solo retransmite el bit (Capa 1).", fecha: "2025-02-11" }
            ]
        },
        { 
            id: 103, 
            titulo: "Implementación de sumador completo con compuertas NAND", 
            descripcion: "Estoy tratando de optimizar el circuito. ¿Algún consejo?", 
            autor: "Pedro González", 
            area: "SistemasDigitales", 
            tags: ["electrónica", "lógica"], 
            fecha: "2025-03-05",
            respuestasList: [
                { id: 1031, autor: "Ingeniero Eléctrico", texto: "Para optimizar un sumador completo con solo NAND, utiliza los mapas de Karnaugh para simplificar las funciones de Suma y Carry al mínimo de términos. Te ahorrará compuertas.", fecha: "2025-03-06" },
                { id: 1032, autor: "Estudiante Avanzado", texto: "Recuerda que con 9 compuertas NAND de dos entradas puedes lograr el sumador completo. Busca el diagrama del 'Full Adder using minimum NAND gates'.", fecha: "2025-03-07" },
                { id: 1033, autor: "Marta Ríos", texto: "¡Asegúrate de que tus diagramas de tiempo cuadren! Un pequeño retraso en el Carry puede arruinarlo todo.", fecha: "2025-03-07" }
            ]
        },
        { 
        }
    ];

    let tutoriales = [
        { id: 201, titulo: "Introducción al Modelo OSI", descripcion: "Comprende la arquitectura de red capa por capa.", autor: "Ana García",
            area: "Redes", fecha: "2025-04-01", enlaceVideo: "modelo-osi.mp4",
            comentariosList: [
                { id: 2011, autor: "Karla Alvarez", texto: "Excelente explicación de la Capa 3! Me ayudó a entender el enrutamiento IP.", fecha: "2025-04-02" },
                { id: 2012, autor: "Profesor Durán", texto: "Muy bien detallado. La parte de la capa física es crucial para los conceptos de transmisión.", fecha: "2025-04-03" }
            ]
        },
        { id: 202, titulo: "Cálculo de Determinantes 3x3", descripcion: "Método de Sarrus explicado paso a paso.", autor: "Dr. Manuel Ríos",
            area: "Matematicas", fecha: "2025-04-15", enlaceVideo: "determinantes-3x3.mp4",
            comentariosList: []
        }, 
        { id: 203, titulo: "Flip-Flops JK y D", descripcion: "Diferencias y aplicaciones en Sistemas Digitales.", autor: "Profesor Durán",
            area: "SistemasDigitales", fecha: "2025-05-01", enlaceVideo: "flip-flops.mp4",
            comentariosList: []
        }, 
        { id: 204, titulo: "Subneteo y VLSM Básico", descripcion: "Aprende a dividir redes usando Subnet Mask Variable.", autor: "Karla Alvarez", area: "Redes", fecha: "2025-05-10", enlaceVideo: "subneteo-vlsm.mp4",
            comentariosList: []
        } 
    ];


    // ==========================================================
    // FUNCIONES GENERALES
    // ==========================================================
    
    function mostrarAlerta(mensaje, type = 'success', elementId = 'status-message-perfil') {
        const status = document.getElementById(elementId);
        if (status) {
            status.textContent = mensaje;
            status.className = `info ${type}`; 
            status.style.display = 'block';
            setTimeout(() => {
                status.style.display = 'none';
            }, 3000);
        } else {
            console.log("ALERTA: " + mensaje);
        }
    }
    
    function getCurrentDateFormatted() {
        const today = new Date();
        const year = '2025'; 
        const month = String(today.getMonth() + 1).padStart(2, '0'); 
        const day = String(today.getDate()).padStart(2, '0');
        return `${year}-${month}-${day}`;
    }

    function cambiarVista(vistaId) {
        document.querySelectorAll('.view-container').forEach(v => {
            v.style.display = 'none';
        });

        const vista = document.getElementById(vistaId);
        if (vista) {
            vista.style.display = 'block';
        }
        
        document.querySelectorAll('.main-grid').forEach(grid => {
            grid.classList.remove('single-column');
        });
        if (vistaId === 'perfil-view' || vistaId === 'notificaciones-view' || vistaId === 'duda-detalle-view' || vistaId === 'tutorial-detalle-view') {
            document.querySelector(`#${vistaId} .main-grid`).classList.add('single-column');
        }

        if (vistaId === 'perfil-view') {
            cargarDatosLectura();
            mostrarSubVistaPerfil('perfil-lectura');
        } else if (vistaId === 'notificaciones-view') {
            renderizarNotificaciones();
        } else if (vistaId === 'foro-dudas-view') {
            renderizarDudas();
            currentDudaId = null; 
        } else if (vistaId === 'tutoriales-view') {
             renderizarTutoriales();
             currentTutorialId = null;
        }

        document.querySelectorAll('.nav button').forEach(btn => {
            btn.classList.remove('activo');
            if (btn.id === 'home-btn') btn.style.backgroundColor = '#1e3a8a';
            if (btn.id === 'notif-btn') btn.style.backgroundColor = '#ff9800';
            if (btn.id === 'perfil-btn') btn.style.backgroundColor = '#48bb78';
            if (btn.id === 'dudas-btn') btn.style.backgroundColor = '#1e3a8a';
            if (btn.id === 'tutoriales-btn') btn.style.backgroundColor = '#1e3a8a';
        });
        
        let activeBtn = null;
        if (vistaId === 'home-view') {
            activeBtn = document.getElementById('home-btn');
            document.getElementById('home-btn').style.backgroundColor = '#3857a6';
        } else if (vistaId === 'perfil-view') {
            activeBtn = document.getElementById('perfil-btn');
            document.getElementById('perfil-btn').style.backgroundColor = '#38a169';
        } else if (vistaId === 'notificaciones-view') {
            activeBtn = document.getElementById('notif-btn');
            document.getElementById('notif-btn').style.backgroundColor = '#e68900';
        } else if (vistaId === 'foro-dudas-view' || vistaId === 'duda-detalle-view') {
             activeBtn = document.getElementById('dudas-btn');
             document.getElementById('dudas-btn').style.backgroundColor = '#3857a6';
        } else if (vistaId === 'tutoriales-view' || vistaId === 'tutorial-detalle-view') {
             activeBtn = document.getElementById('tutoriales-btn');
             document.getElementById('tutoriales-btn').style.backgroundColor = '#3857a6';
        }

        if (activeBtn) {
            activeBtn.classList.add('activo');
        }
    }
    
    function abrirModal(modalId) {
        document.getElementById(modalId).style.display = 'block';
    }

    function cerrarModal(modalId) {
        document.getElementById(modalId).style.display = 'none';
        if (modalId === 'dudaModal') {
             document.getElementById('new-duda-form').reset();
             document.getElementById('status-message-modal').style.display = 'none';
        }
        if (modalId === 'tutorialModal') {
             document.getElementById('new-tutorial-form').reset();
             document.getElementById('status-message-tutorial-modal').style.display = 'none';
        }
        if (modalId === 'editarRespuestaModal') {
             document.getElementById('status-message-respuesta-edit').style.display = 'none';
        }
        if (modalId === 'editarComentarioModal') { 
            document.getElementById('status-message-comentario-edit').style.display = 'none';
        }
    }


    // ==========================================================
    // FUNCIONES DE PERFIL
    // ==========================================================

    function mostrarSubVistaPerfil(subVistaId) {
        const lectura = document.getElementById('perfil-lectura');
        const edicion = document.getElementById('perfil-edicion');
        
        if (subVistaId === 'perfil-lectura') {
            lectura.style.display = 'block';
            edicion.style.display = 'none';
            cargarDatosLectura();
        } else if (subVistaId === 'perfil-edicion') {
            lectura.style.display = 'none';
            edicion.style.display = 'block';
            cargarDatosFormulario();
        }
    }

    function cargarDatosLectura() {
        document.getElementById('perfil-nombre-display').textContent = usuario.nombreCompleto;
        document.getElementById('perfil-desc-display').textContent = usuario.descripcion;
        document.getElementById('info-nombre').textContent = usuario.nombreCompleto;
        document.getElementById('info-email').textContent = usuario.email;
        document.getElementById('info-interes').textContent = usuario.interesPrincipalDisplay;
        document.getElementById('info-miembro').textContent = usuario.miembroDesde; 
        document.getElementById('info-contribuciones').textContent = usuario.contribuciones; 
    }
    
    function cargarDatosFormulario() {
        if (document.getElementById('profile-form')) {
            document.getElementById('nombreCompleto').value = usuario.nombreCompleto;
            document.getElementById('email').value = usuario.email;
            document.getElementById('interesPrincipal').value = usuario.interesPrincipal;
            document.getElementById('descripcion').value = usuario.descripcion;
        }
    }

    function guardarPerfil() {
        const nombre = document.getElementById('nombreCompleto').value;
        const email = document.getElementById('email').value;
        const interesCode = document.getElementById('interesPrincipal').value;
        const desc = document.getElementById('descripcion').value;

        usuario.nombreCompleto = nombre;
        usuario.email = email;
        usuario.interesPrincipal = interesCode;
        usuario.interesPrincipalDisplay = interesMap[interesCode];
        usuario.descripcion = desc;
        
        mostrarAlerta(`¡Perfil actualizado con éxito!`, 'success', 'status-message-perfil');

        setTimeout(() => {
            mostrarSubVistaPerfil('perfil-lectura');
        }, 500);
    }


    // ==========================================================
    // FUNCIONES DE NOTIFICACIONES
    // ==========================================================

    function getAuthor(tipo, id) {
        if (tipo === 'duda') {
            const duda = dudas.find(d => d.id === id);
            return duda ? duda.autor : null;
        } else if (tipo === 'tutorial') {
            const tutorial = tutoriales.find(t => t.id === id);
            return tutorial ? tutorial.autor : null;
        }
        return null;
    }

    // NUEVA FUNCIÓN: Navegar desde notificación al contenido correspondiente
    function irADetalleDesdeNotificacion(notifId) {
        const notif = notificaciones.find(n => n.id === notifId);
        if (notif) {
            // Marcar como leída si no lo está
            if (!notif.leida) {
                notif.leida = true;
                renderizarNotificaciones();
            }

            // Navegar a la vista de detalle correspondiente
            setTimeout(() => {
                if (notif.tipo === 'duda') {
                    mostrarDetalleDuda(notif.targetId);
                } else if (notif.tipo === 'tutorial') {
                    mostrarDetalleTutorial(notif.targetId);
                }
            }, 100);
        }
    }

    function toggleNotif(checkbox) {
        notificacionesActivadas = checkbox.checked;
        const mensaje = notificacionesActivadas 
            ? 'Notificaciones de respuesta activadas.'
            : 'Notificaciones de respuesta desactivadas.';
        mostrarAlerta(mensaje, 'info', 'status-message-notif');
    }

    function renderizarNotificaciones() {
        const listContainer = document.getElementById('notif-list');
        const badge = document.getElementById('notif-badge');
        const countDisplay = document.getElementById('notif-count');
        
        const filteredNotifs = notificaciones.filter(n => currentNotifFilter === 'all');

        const noLeidas = notificaciones.filter(n => !n.leida).length;
        
        countDisplay.textContent = noLeidas;
        badge.textContent = noLeidas;
        badge.style.display = noLeidas > 0 ? 'inline-block' : 'none';

        listContainer.innerHTML = ''; 
        
        if (filteredNotifs.length === 0) {
            listContainer.innerHTML = '<p style="text-align:center; color:#718096; padding:30px; background:#f0f4f8; border-radius:8px;">No hay notificaciones para este filtro.</p>';
            return;
        }

        filteredNotifs.forEach(notif => {
            const icon = notif.tipo === 'duda' ? 'fas fa-question-circle' : 'fas fa-book-open';
            const itemClass = notif.leida ? 'notification-item' : 'notification-item unread';
            
            let notificationMessage = notif.texto;
            const targetAuthor = getAuthor(notif.tipo, notif.targetId);
            const isCurrentUserAuthor = targetAuthor === usuario.nombreCompleto;
            
            if (notif.tipo === 'duda') {
                if (!isCurrentUserAuthor) {
                    notificationMessage = notificationMessage.replace(/tu duda|te ha respondido tu duda/gi, 'en la duda que comentaste');
                }
            }
            
            const formattedText = notificationMessage.replace(/\*(.*?)\*/g, '<b>$1</b>');

            const itemHTML = `
                <div class="${itemClass}" onclick="marcarLeida(${notif.id})">
                    <div class="notif-icon" style="color: ${notif.leida ? '#4299e1' : '#ff9800'};"><i class="${icon}"></i></div>
                    <div class="notif-content">
                        <strong>${notif.titulo}</strong>
                        <p>${formattedText}</p>
                        <span>Hace 5 minutos - 
                            <a href="#" style="color: #4299e1; cursor: pointer; text-decoration: underline;" 
                               onclick="event.stopPropagation(); irADetalleDesdeNotificacion(${notif.id}); return false;">
                                Ver contenido
                            </a>
                        </span>
                    </div>
                </div>
            `;
            listContainer.innerHTML += itemHTML;
        });

        document.getElementById('toggleNotificaciones').checked = notificacionesActivadas;
    }

    function marcarLeida(id) {
        const notif = notificaciones.find(n => n.id === id);
        if (notif && !notif.leida) {
            notif.leida = true;
            renderizarNotificaciones();
        }
    }

    function marcarTodasLeidas() {
        let huboCambios = false;
        notificaciones.forEach(n => {
            if (!n.leida) {
                n.leida = true;
                huboCambios = true;
            }
        });
        if (huboCambios) {
            renderizarNotificaciones();
            mostrarAlerta('Todas las notificaciones han sido marcadas como leídas.', 'info', 'status-message-notif');
        } else {
            mostrarAlerta('No hay notificaciones no leídas para marcar.', 'info', 'status-message-notif');
        }
    }
    
    // ==========================================================
    // FUNCIONES DE DUDAS
    // ==========================================================

    function filtrarDudas(filter) {
        currentDudaFilter = filter;
        renderizarDudas();
        if (filter !== 'all') {
             mostrarAlerta(`Filtro aplicado: ${interesMap[filter] || filter}`, 'info', 'status-message-duda');
        } else {
             document.getElementById('status-message-duda').style.display = 'none';
        }
    }

    function renderizarDudas() {
        const listContainer = document.getElementById('dudas-list');
        const filteredDudas = dudas.filter(d => currentDudaFilter === 'all' || d.area === currentDudaFilter);
        
        document.getElementById('dudas-total-count').textContent = dudas.length;
        listContainer.innerHTML = '';

        if (filteredDudas.length === 0) {
            listContainer.innerHTML = `<p style="text-align:center; color:#718096; padding:30px; background:#f0f4f8; border-radius:8px;">No se encontraron dudas para el filtro: ${interesMap[currentDudaFilter] || 'Todas las áreas'}.</p>`;
            return;
        }

        filteredDudas.sort((a, b) => new Date(b.fecha) - new Date(a.fecha));

        filteredDudas.forEach(duda => {
            const tagHTML = duda.tags.map(tag => `<span class="tag">${tag}</span>`).join('');
            
            const areaDisplay = interesMap[duda.area] || duda.area;
            const respuestasCount = duda.respuestasList ? duda.respuestasList.length : 0;
            const respuestasText = respuestasCount === 1 ? '1 Respuesta' : `${respuestasCount} Respuestas`;

            const itemHTML = `
                <div class="card duda-card" onclick="mostrarDetalleDuda(${duda.id})" style="cursor: pointer;">
                    <h3><i class="fas fa-question-circle" style="color:#4299e1; margin-right: 5px;"></i>${duda.titulo}</h3>
                    <p>${duda.descripcion.substring(0, 100)}...</p>
                    <div>${tagHTML}</div>
                    <div class="meta">
                        <span>Área: <b>${areaDisplay}</b></span>
                        <span>Autor: <b>${duda.autor}</b></span>
                        <span style="font-weight: bold; color: #1e3a8a;">${respuestasText}</span>
                    </div>
                </div>
            `;
            listContainer.innerHTML += itemHTML;
        });
    }
    
    function publicarDuda() {
        const titulo = document.getElementById('dudaTitulo').value.trim();
        const area = document.getElementById('dudaArea').value;
        const descripcion = document.getElementById('dudaDescripcion').value.trim();
        const tagsInput = document.getElementById('dudaTags').value.trim();
        
        if (!titulo || !area || !descripcion) {
            mostrarAlerta('Por favor, complete todos los campos requeridos (Título, Área y Descripción).', 'info', 'status-message-modal');
            return;
        }
        
        const tagsArray = tagsInput.split(',').map(tag => tag.trim()).filter(tag => tag);

        const newDuda = {
            id: Date.now(), 
            titulo: titulo,
            descripcion: descripcion,
            autor: usuario.nombreCompleto, 
            area: area,
            tags: tagsArray,
            fecha: getCurrentDateFormatted(), 
            respuestasList: []
        };
        dudas.unshift(newDuda); 

        mostrarAlerta('¡Duda publicada con éxito! Será revisada por la comunidad.', 'success', 'status-message-modal');
        document.getElementById('new-duda-form').reset();
        
        setTimeout(() => {
            cerrarModal('dudaModal');
            if (document.getElementById('foro-dudas-view').style.display !== 'block') {
                cambiarVista('foro-dudas-view');
            } else {
                 renderizarDudas();
            }
        }, 1500);
    }
    
    function mostrarDetalleDuda(id) {
        const duda = dudas.find(d => d.id === id);
        
        if (!duda) {
            alert('Error: Duda no encontrada.');
            return;
        }

        currentDudaId = id;

        const areaDisplay = interesMap[duda.area] || duda.area;
        const respuestasListContainer = document.getElementById('respuestas-list');
        const respuestasCount = duda.respuestasList ? duda.respuestasList.length : 0;
        
        document.getElementById('detalle-titulo').textContent = duda.titulo;
        document.getElementById('detalle-autor').textContent = duda.autor;
        document.getElementById('detalle-fecha').textContent = duda.fecha;
        document.getElementById('detalle-area').textContent = areaDisplay;
        document.getElementById('detalle-descripcion').textContent = duda.descripcion;
        
        const tagHTML = duda.tags.map(tag => `<span class="tag">${tag}</span>`).join('');
        document.getElementById('detalle-tags').innerHTML = '<strong>Etiquetas:</strong> ' + tagHTML;
        
        document.getElementById('respuestas-count').textContent = respuestasCount;
        respuestasListContainer.innerHTML = '';

        if (respuestasCount === 0) {
            respuestasListContainer.innerHTML = `
                <div class="info" style="margin-bottom: 15px; border-left: 5px solid #a0aec0;">
                    <p style="margin: 0; font-weight: bold;">Sé el primero en responder.</p>
                    <p style="margin: 5px 0 0 0; font-size: 0.9rem;">(No hay respuestas para esta duda todavía.)</p>
                </div>
            `;
        } else {
            duda.respuestasList.forEach(respuesta => {
                const esPropia = respuesta.autor === usuario.nombreCompleto;
                
                const accionesHTML = esPropia ? `
                    <div class="respuesta-actions">
                        <button class="edit-btn" onclick="iniciarEdicionRespuesta(${duda.id}, ${respuesta.id})"><i class="fas fa-edit"></i> Editar</button>
                        <button class="delete-btn" onclick="eliminarRespuesta(${duda.id}, ${respuesta.id})"><i class="fas fa-trash-alt"></i> Eliminar</button>
                    </div>
                ` : '<div class="respuesta-actions"></div>';

                const adjuntoHTML = ''; 

                const respuestaHTML = `
                    <div class="respuesta-card">
                        <p style="white-space: pre-wrap;">${respuesta.texto}</p>
                        ${adjuntoHTML} 
                        <div class="meta-respuesta">
                            <span>Respuesta de: <b>${respuesta.autor}</b> el ${respuesta.fecha}</span>
                            ${accionesHTML}
                        </div>
                    </div>
                `;
                respuestasListContainer.innerHTML += respuestaHTML;
            });
        }

        document.getElementById('new-respuesta-form').reset();
        document.getElementById('status-message-respuesta-add').style.display = 'none';

        cambiarVista('duda-detalle-view');
    }
    
    function agregarRespuesta(dudaId) {
        const duda = dudas.find(d => d.id === dudaId);
        const texto = document.getElementById('respuestaTexto').value.trim();
        const statusElement = document.getElementById('status-message-respuesta-add');

        if (!duda || !texto) {
            mostrarAlerta('El campo de respuesta no puede estar vacío.', 'info', 'status-message-respuesta-add');
            return;
        }

        const nuevaRespuesta = {
            id: Date.now(),
            autor: usuario.nombreCompleto,
            texto: texto,
            fecha: getCurrentDateFormatted(),
        };

        duda.respuestasList.push(nuevaRespuesta);
        
        document.getElementById('new-respuesta-form').reset();
        
        mostrarAlerta('¡Respuesta publicada con éxito!', 'success', 'status-message-respuesta-add');
        
        setTimeout(() => {
            mostrarDetalleDuda(dudaId);
        }, 500);
    }
    
    function iniciarEdicionRespuesta(dudaId, respuestaId) {
        const duda = dudas.find(d => d.id === dudaId);
        const respuesta = duda ? duda.respuestasList.find(r => r.id === respuestaId) : null;
        
        if (!respuesta || respuesta.autor !== usuario.nombreCompleto) {
            alert('Error: No puedes editar esta respuesta.');
            return;
        }

        document.getElementById('editDudaId').value = dudaId;
        document.getElementById('editRespuestaId').value = respuestaId;
        document.getElementById('editRespuestaTexto').value = respuesta.texto;
        
        abrirModal('editarRespuestaModal');
    }

    function guardarEdicionRespuesta() {
        const dudaId = parseInt(document.getElementById('editDudaId').value);
        const respuestaId = parseInt(document.getElementById('editRespuestaId').value);
        const nuevoTexto = document.getElementById('editRespuestaTexto').value.trim();
        
        const duda = dudas.find(d => d.id === dudaId);
        const respuesta = duda ? duda.respuestasList.find(r => r.id === respuestaId) : null;

        if (!respuesta || !nuevoTexto) {
            mostrarAlerta('El texto de la respuesta no puede estar vacío.', 'info', 'status-message-respuesta-edit');
            return;
        }
        
        respuesta.texto = nuevoTexto;
        
        mostrarAlerta('¡Respuesta editada con éxito!', 'success', 'status-message-respuesta-edit');
        
        setTimeout(() => {
            cerrarModal('editarRespuestaModal');
            mostrarDetalleDuda(dudaId);
        }, 500);
    }

    function eliminarRespuesta(dudaId, respuestaId) {
        if (!confirm('¿Estás seguro de que quieres eliminar esta respuesta? Esta acción es irreversible.')) {
            return;
        }

        const duda = dudas.find(d => d.id === dudaId);

        if (duda) {
            const initialLength = duda.respuestasList.length;
            
            duda.respuestasList = duda.respuestasList.filter(r => r.id !== respuestaId);
            
            if (duda.respuestasList.length < initialLength) {
                setTimeout(() => {
                    mostrarAlerta('Respuesta eliminada con éxito.', 'info', 'status-message-duda');
                }, 50);

                mostrarDetalleDuda(dudaId);
                
            } else {
                 alert('Error al intentar eliminar la respuesta.');
            }
        } else {
            alert('Error: Duda no encontrada.');
        }
    }


    // ==========================================================
    // FUNCIONES DE TUTORIALES (CON COMENTARIOS)
    // ==========================================================

    function filtrarTutoriales(filter) {
        currentTutorialFilter = filter;
        renderizarTutoriales();
        if (filter !== 'all') {
             mostrarAlerta(`Filtro aplicado: ${interesMap[filter] || filter}`, 'info', 'status-message-tutorial');
        } else {
             document.getElementById('status-message-tutorial').style.display = 'none';
        }
    }

    function renderizarTutoriales() {
        const listContainer = document.getElementById('tutoriales-list');
        const filteredTutoriales = tutoriales.filter(t => currentTutorialFilter === 'all' || t.area === currentTutorialFilter);
        
        document.getElementById('tutoriales-total-count').textContent = tutoriales.length;
        listContainer.innerHTML = '';

        if (filteredTutoriales.length === 0) {
            listContainer.innerHTML = `<p style="text-align:center; color:#718096; padding:30px; background:#f0f4f8; border-radius:8px;">No se encontraron tutoriales para el filtro: ${interesMap[currentTutorialFilter] || 'Todos'}.</p>`;
            return;
        }

        filteredTutoriales.sort((a, b) => new Date(b.fecha) - new Date(a.fecha));

        filteredTutoriales.forEach(tutorial => {
            const areaDisplay = interesMap[tutorial.area] || tutorial.area;

            const videoHTML = tutorial.enlaceVideo ? `
                <div class="video-container">
                    <iframe 
                        src="${tutorial.enlaceVideo}" 
                        title="${tutorial.titulo}" 
                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                        allowfullscreen>
                    </iframe>
                </div>
            ` : `
                <div class="video-container" style="background: #a0aec0; display: flex; align-items: center; justify-content: center; color: white;">
                    <i class="fas fa-exclamation-triangle" style="font-size: 30px;"></i>
                    <span style="margin-left: 10px;">Video no disponible</span>
                </div>
            `;


            const itemHTML = `
                <div class="tutorial-item" onclick="mostrarDetalleTutorial(${tutorial.id})">
                    ${videoHTML}
                    <div class="tutorial-content">
                        <h4>${tutorial.titulo}</h4>
                        <p>${tutorial.descripcion.substring(0, 150)}${tutorial.descripcion.length > 150 ? '...' : ''}</p>
                        <div class="tutorial-meta">
                            <span>Área: <b>${areaDisplay}</b></span>
                            <span>Autor: <b>${tutorial.autor}</b></span>
                            <span>Publicado: <b>${tutorial.fecha}</b></span>
                        </div>
                    </div>
                </div>
            `;
            listContainer.innerHTML += itemHTML;
        });
    }

    function publicarTutorial() {
        const titulo = document.getElementById('tutorialTitulo').value.trim();
        const area = document.getElementById('tutorialArea').value;
        const descripcion = document.getElementById('tutorialDescripcion').value.trim();
        let enlace = document.getElementById('tutorialEnlace').value.trim();
        
        if (!titulo || !area || !descripcion || !enlace) {
            mostrarAlerta('Por favor, complete todos los campos requeridos.', 'info', 'status-message-tutorial-modal');
            return;
        }
        
        let videoId = null;
        const watchUrlMatch = enlace.match(/(?:v=|\/embed\/|youtu\.be\/|\/v\/|embed\/)([a-zA-Z0-9_-]{11})/);
        
        if (watchUrlMatch && watchUrlMatch[1]) {
            videoId = watchUrlMatch[1];
        }
        
        if (videoId) {
            enlace = `https://www.youtube.com/embed/${videoId}`;
            mostrarAlerta('Enlace de YouTube convertido exitosamente a formato de embed.', 'info', 'status-message-tutorial-modal');
        } else if (!enlace.includes('youtube.com/embed/')) {
             mostrarAlerta('El enlace proporcionado no pudo ser reconocido como un un enlace embed de YouTube válido. Se usará el enlace tal cual, pero puede fallar si no es un enlace *embed* o de otra plataforma.', 'info', 'status-message-tutorial-modal');
        }
        
        const newTutorial = {
            id: Date.now(), 
            titulo: titulo,
            descripcion: descripcion,
            autor: usuario.nombreCompleto, 
            area: area,
            fecha: getCurrentDateFormatted(), 
            enlaceVideo: enlace,
            comentariosList: []
        };
        tutoriales.unshift(newTutorial);

        mostrarAlerta('¡Tutorial publicado con éxito! Ya se encuentra disponible para visualizar.', 'success', 'status-message-tutorial-modal');
        document.getElementById('new-tutorial-form').reset();
        
        setTimeout(() => {
            cerrarModal('tutorialModal');
            if (document.getElementById('tutoriales-view').style.display !== 'block') {
                cambiarVista('tutoriales-view');
            } else {
                 renderizarTutoriales();
            }
        }, 1500);
    }
    
    function mostrarDetalleTutorial(id) {
        const tutorial = tutoriales.find(t => t.id === id);
        
        if (!tutorial) {
            alert('Error: Tutorial no encontrado.');
            return;
        }

        currentTutorialId = id;

        const areaDisplay = interesMap[tutorial.area] || tutorial.area;
        
        document.getElementById('tutorial-detalle-titulo').textContent = tutorial.titulo;
        document.getElementById('tutorial-detalle-autor').textContent = tutorial.autor;
        document.getElementById('tutorial-detalle-fecha').textContent = tutorial.fecha;
        document.getElementById('tutorial-detalle-area').textContent = areaDisplay;
        document.getElementById('tutorial-detalle-descripcion').textContent = tutorial.descripcion;
        
        document.getElementById('tutorial-video-container').innerHTML = `
             <iframe 
                src="${tutorial.enlaceVideo}" 
                title="${tutorial.titulo}" 
                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                style="width: 100%; height: 100%; border: none;"
                allowfullscreen>
            </iframe>
        `;
        
        const comentariosListContainer = document.getElementById('comentarios-list');
        const comentariosCount = tutorial.comentariosList ? tutorial.comentariosList.length : 0;
        
        document.getElementById('comentarios-count').textContent = comentariosCount;
        comentariosListContainer.innerHTML = '';

        if (comentariosCount === 0) {
            comentariosListContainer.innerHTML = `
                <div class="info" style="margin-bottom: 15px; border-left: 5px solid #a0aec0;">
                    <p style="margin: 0; font-weight: bold;">Sé el primero en comentar.</p>
                    <p style="margin: 5px 0 0 0; font-size: 0.9rem;">(No hay comentarios para este tutorial todavía.)</p>
                </div>
            `;
        } else {
            tutorial.comentariosList.forEach(comentario => {
                const esPropio = comentario.autor === usuario.nombreCompleto;
                
                const accionesHTML = esPropio ? `
                    <div class="respuesta-actions">
                        <button class="edit-btn" onclick="iniciarEdicionComentario(${tutorial.id}, ${comentario.id})"><i class="fas fa-edit"></i> Editar</button>
                        <button class="delete-btn" onclick="eliminarComentario(${tutorial.id}, ${comentario.id})"><i class="fas fa-trash-alt"></i> Eliminar</button>
                    </div>
                ` : '<div class="respuesta-actions"></div>';


                const comentarioHTML = `
                    <div class="comentario-card">
                        <p style="white-space: pre-wrap;">${comentario.texto}</p>
                        <div class="meta-comentario">
                            <span>Comentario de: <b>${comentario.autor}</b> el ${comentario.fecha}</span>
                            ${accionesHTML}
                        </div>
                    </div>
                `;
                comentariosListContainer.innerHTML += comentarioHTML;
            });
        }

        document.getElementById('new-comentario-form').reset();
        document.getElementById('status-message-comentario-add').style.display = 'none';

        cambiarVista('tutorial-detalle-view');
    }
    
    function agregarComentario(tutorialId) {
        const tutorial = tutoriales.find(t => t.id === tutorialId);
        const texto = document.getElementById('comentarioTexto').value.trim();

        if (!tutorial || !texto) {
            mostrarAlerta('El campo de comentario no puede estar vacío.', 'info', 'status-message-comentario-add');
            return;
        }

        const nuevoComentario = {
            id: Date.now(),
            autor: usuario.nombreCompleto,
            texto: texto,
            fecha: getCurrentDateFormatted(),
        };

        tutorial.comentariosList.push(nuevoComentario);
        
        document.getElementById('new-comentario-form').reset();
        
        mostrarAlerta('¡Comentario publicado con éxito!', 'success', 'status-message-comentario-add');
        
        setTimeout(() => {
            mostrarDetalleTutorial(tutorialId);
        }, 500);
    }
    
    function iniciarEdicionComentario(tutorialId, comentarioId) {
        const tutorial = tutoriales.find(t => t.id === tutorialId);
        const comentario = tutorial ? tutorial.comentariosList.find(c => c.id === comentarioId) : null;
        
        if (!comentario || comentario.autor !== usuario.nombreCompleto) {
            alert('Error: No puedes editar este comentario.');
            return;
        }

        document.getElementById('editTutorialId').value = tutorialId;
        document.getElementById('editComentarioId').value = comentarioId;
        document.getElementById('editComentarioTexto').value = comentario.texto;
        
        abrirModal('editarComentarioModal');
    }

    function guardarEdicionComentario() {
        const tutorialId = parseInt(document.getElementById('editTutorialId').value);
        const comentarioId = parseInt(document.getElementById('editComentarioId').value);
        const nuevoTexto = document.getElementById('editComentarioTexto').value.trim();
        
        const tutorial = tutoriales.find(t => t.id === tutorialId);
        const comentario = tutorial ? tutorial.comentariosList.find(c => c.id === comentarioId) : null;

        if (!comentario || !nuevoTexto) {
            mostrarAlerta('El texto del comentario no puede estar vacío.', 'info', 'status-message-comentario-edit');
            return;
        }
        
        comentario.texto = nuevoTexto;
        
        mostrarAlerta('¡Comentario editado con éxito!', 'success', 'status-message-comentario-edit');
        
        setTimeout(() => {
            cerrarModal('editarComentarioModal');
            mostrarDetalleTutorial(tutorialId);
        }, 500);
    }

    function eliminarComentario(tutorialId, comentarioId) {
        if (!confirm('¿Estás seguro de que quieres eliminar este comentario? Esta acción es irreversible.')) {
            return;
        }

        const tutorial = tutoriales.find(t => t.id === tutorialId);

        if (tutorial) {
            const initialLength = tutorial.comentariosList.length;
            
            tutorial.comentariosList = tutorial.comentariosList.filter(c => c.id !== comentarioId);
            
            if (tutorial.comentariosList.length < initialLength) {
                setTimeout(() => {
                    mostrarAlerta('Comentario eliminado con éxito.', 'info', 'status-message-tutorial');
                }, 50);

                mostrarDetalleTutorial(tutorialId);
                
            } else {
                 alert('Error al intentar eliminar el comentario.');
            }
        } else {
            alert('Error: Tutorial no encontrado.');
        }
    }


    // ==========================================================
    // INICIALIZACIÓN
    // ==========================================================
    document.addEventListener('DOMContentLoaded', function() {
        renderizarNotificaciones();
        renderizarDudas(); 
        
        document.getElementById('home-btn').classList.add('activo');
    });

</script>

</body>
</html>
